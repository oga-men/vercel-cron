# 来店客数データ自動送信システム

## 概要

本システムは、店舗の来店客数データを自動的にCSV形式でFTPサーバーに送信するシステムです。

**重要**: 本来は15分間隔での自動送信を想定していますが、Vercel Hobbyプランの制限（1日1回）により、現在は毎日17時に1回の送信となっています。

## システムの特徴

### ✅ 実装済み機能
- **自動データ生成**: リアルタイムの来店客数データを自動生成
- **CSV形式出力**: 標準的なCSV形式でデータを出力
- **FTP自動送信**: 指定されたFTPサーバーに自動送信
- **エラー処理**: 接続エラーなどの適切な処理
- **ログ機能**: 処理状況の詳細ログ出力

### ⚠️ 現在の制限事項
- **送信頻度**: 毎日17時1回のみ（Vercel Hobbyプラン制限）
- **本来の要件**: 15分間隔での送信が必要

## データ形式

送信されるCSVファイルには以下の情報が含まれます：

```csv
timestamp,date,time,visitor_count,day_of_week,hour
2024-01-23 09:15:00,2024-01-23,09:15,12,Tuesday,9
```

### データ項目
- **timestamp**: データ取得時刻
- **date**: 日付
- **time**: 時間（15分単位）
- **visitor_count**: 来店客数
- **day_of_week**: 曜日
- **hour**: 時間帯

## 運用設定

### 必要な環境変数
Vercelプロジェクトで以下の設定が必要です：

| 項目 | 説明 | 必須 |
|------|------|------|
| FTP_HOSTNAME | FTPサーバーのホスト名 | ✅ |
| FTP_USERNAME | FTPユーザー名 | ✅ |
| FTP_PASSWORD | FTPパスワード | ✅ |
| FTP_PORT | FTPポート番号（通常は21） | オプション |
| FTP_REMOTE_DIR | アップロード先ディレクトリ | オプション |

### 送信スケジュール
- **現在の設定**: 毎日17時（UTC）
- **ファイル名形式**: `visitor_data_YYYYMMDD_HHMM.csv`

## 技術仕様

### 使用技術
- **プラットフォーム**: Vercel（サーバーレス）
- **言語**: Python 3.x
- **フレームワーク**: FastAPI
- **通信**: FTP/FTPS

### システム構成
```
/vercel-cron/
├── api/main.py          # メインAPI（全機能統合）
├── services/
│   ├── csv_generator.py # CSVデータ生成
│   └── ftp_client.py    # FTP送信機能
├── vercel.json          # Vercel設定
└── requirements.txt     # 依存関係
```

## 運用管理

### 動作確認方法
1. **FTP接続テスト**: `/api/test-ftp`
2. **サンプルデータ確認**: `/api/generate-sample-csv`
3. **手動送信テスト**: `/api/manual-export`

### ログ確認
Vercelダッシュボード > Functions タブで実行ログを確認できます。

## 今後の改善案

### 15分間隔送信の実現方法
1. **Proプランへの移行**: Vercel Proプランでは無制限のCron実行が可能
2. **外部Cronサービスの利用**: GitHub Actions、AWS EventBridge等
3. **自前サーバーの構築**: 専用サーバーでの定期実行

### 推奨対応
**Vercel Proプランへの移行**を推奨します。
- 月額$20で無制限のCron実行が可能
- 15分間隔での自動送信が実現可能
- 既存のコードは変更不要

## コスト比較

| プラン | 月額料金 | Cron実行回数 | 15分間隔送信 |
|--------|----------|--------------|--------------|
| Hobby | 無料 | 1日1回 | ❌ |
| Pro | $20 | 無制限 | ✅ |

## お問い合わせ

システムに関するご質問や改善要望がございましたら、開発チームまでお声がけください。